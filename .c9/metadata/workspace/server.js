{"changed":true,"filter":false,"title":"server.js","tooltip":"/server.js","value":"var http = require(\"http\");\nvar url = require(\"url\");\nvar util = require(\"util\");\nvar session = require(\"./configuration/sessionManager\");\n\n//jeden session manager dla całego serwerka\n\n\nfunction start(route, configuration){\n\t\n\tif(configuration.OnServerStart)\n\t\tconfiguration.OnServerStart();\n\t\n\tvar sessionTime = 1200000; //domyślnie dwie minuty\n\t\n\tif(configuration.SessionTime) //pobieranie z pliku configuration\n\t\tsessionTime = configuration.SessionTime;\n\t\n\tvar sessionManager = new session(sessionTime, configuration); \n\t\n\t\n\tfunction onRequest(request, response){\n\t\t    \n\t\t    var userSession = sessionManager.CheckIfSessionExist(request, response);\n\t\t    \n\t\t    this.request = request;\n\t\t    this.response = response;\n\t\t\tthis.pathName = url.parse(request.url).pathname;\n\t\t\tthis.query = url.parse(request.url, true).query;\n\t\t\tthis.session = userSession;\n\t\t\tif(configuration.OnEveryRequest){\n\t\t\t    //Założenie jest takie, że OnEveryRequest może zmienić całą trasę dla requesta\n\t\t\t    //Wrzucone do niego pathName, query, response i request mogą zostać zmodyfikowane,\n\t\t\t    //A ruch przekierowany gdzie indziej.\n\t\t        configuration.OnEveryRequest.call(this);\n\t\t\t}\n\t\t\troute(this.pathName, this.response, this.request, this.query, this.session, configuration);\t\n\t}\n\n\thttp.createServer(onRequest).listen(8080,function(err) {\n    if (err) return cb(err);\n\n    // Find out which user used sudo through the environment variable\n    var uid = parseInt(process.env.SUDO_UID);\n    // Set our server's uid to that user\n    if (uid) process.setuid(uid);\n    console.log('Server\\'s UID is now ' + process.getuid());\n  });\n\n\tconsole.log(\"Server started\");\n}\n\nexports.start = start;","undoManager":{"mark":-2,"position":1,"stack":[[{"start":{"row":18,"column":45},"end":{"row":18,"column":48},"action":"insert","lines":[", c"],"id":1}],[{"start":{"row":18,"column":48},"end":{"row":18,"column":50},"action":"insert","lines":["on"],"id":2},{"start":{"row":18,"column":47},"end":{"row":18,"column":50},"action":"remove","lines":["con"]},{"start":{"row":18,"column":47},"end":{"row":18,"column":60},"action":"insert","lines":["configuration"]}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":240,"scrollleft":0,"selection":{"start":{"row":31,"column":19},"end":{"row":31,"column":19},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":16,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1418910184000}